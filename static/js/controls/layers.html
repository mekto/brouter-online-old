<div class="box{{ expanded ? ' expanded' : '' }}">
  <header on-click="toggle">
    <span class="control-button" on-click="layers" title="Layers">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="icon" viewBox="0 0  23.303 21.461">
        <polygon points="23.303,6.333 11.652,0 0,6.333 11.652,12.667" class="fill" />
        <polygon points="11.652,14.709 2.166,9.555 0,10.732 11.652,17.063 23.303,10.732 21.137,9.555" class="fill" />
        <polygon points="11.652,19.107 2.166,13.952 0,15.127 11.652,21.461 23.303,15.127 21.137,13.952" class="fill" />
      </svg>
    </span>
  </header>

  {{#expanded}}
  <div class="menu layers-menu">
    <p><strong>Layers</strong></p>
    {{#layers}}
      <div on-click="setLayer:{{this}}" class="layer-preview{{ (name === activeLayer.name) ? ' active' : '' }}">
        <span class="title">{{name}}</span>
        {{#variants.length}}
        <ul class="variants">
          {{#variants}}
          <li on-click="setLayer:{{ ../ }},{{this}}" class="{{ (name === activeLayer.name && this === activeLayer.variant) ? 'active' : '' }}">
            {{# this === 'bicycling' }}
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon" width="18" height="18">
              <g transform="translate(0,-1034.3622)">
                <g transform="translate(-108,-352)">
                  <path d="m 240,339 0,1 1,0.5 0,1.5 -5,0 0,-1 1,0 0,-0.5 -1,-0.5 -2,0 0,1 1,0 0,1 -1.25,2.125 C 233.50461,344.06012 233.26579,344 233,344 c -1.65686,0 -3,1.34314 -3,3 0,1.65686 1.34314,3 3,3 1.65686,0 3,-1.34314 3,-3 l 1,0 2.5,-4 1.5,0 0.53125,1.0625 C 240.10342,344.29297 239,345.50713 239,347 c 0,1.65685 1.34315,3 3,3 1.65685,0 3,-1.34315 3,-3 0,-1.43939 -1.02256,-2.64661 -2.375,-2.9375 L 242,342.5 242,340 241.5,339.5 240,339 z m -4.5,4 3,0 -2,3 -0.6875,0 c -0.21207,-0.59119 -0.58733,-1.11568 -1.09375,-1.46875 L 235.5,343 z m -2.5,2.25 c 0.9665,0 1.75,0.7835 1.75,1.75 0,0.9665 -0.7835,1.75 -1.75,1.75 -0.9665,0 -1.75,-0.7835 -1.75,-1.75 0,-0.9665 0.7835,-1.75 1.75,-1.75 z m 9,0 c 0.9665,0 1.75,0.7835 1.75,1.75 0,0.9665 -0.7835,1.75 -1.75,1.75 -0.9665,0 -1.75,-0.7835 -1.75,-1.75 0,-0.9665 0.7835,-1.75 1.75,-1.75 z"
                     class="fill" transform="translate(-120,1050.3622)" />
                </g>
              </g>
            </svg>
            {{/bicycling}}
            {{# this === 'transit' }}
            <svg version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon" width="18" height="18">
              <g transform="translate(0,-1034.3622)">
                <path d="M 8 2 L 8 3 L 7.5 3 C 6.669 3 6 3.669 6 4.5 L 6 9.5 L 6 10.5 C 6 11.331 6.669 12 7.5 12 L 11.5 12 C 12.331 12 13 11.331 13 10.5 L 13 9.5 L 13 4.5 C 13 3.669 12.331 3 11.5 3 L 11 3 L 11 2 L 8 2 z M 8 4 L 11 4 C 11.553621 4 12 4.446 12 5 L 12 5.5 L 12 5.75 L 12 7 L 7 7 L 7 5.75 L 7 5.5 L 7 5 C 7 4.446 7.4463787 4 8 4 z M 7 9 L 8.5 9 L 8.5 10.5 L 7 10.5 L 7 9 z M 10.5 9 L 12 9 L 12 10.5 L 10.5 10.5 L 10.5 9 z "
                   transform="translate(0,1034.3622)" class="fill" />
                <path class="fill" d="m 9,1047.3622 -3,0 0,1 -1,0 0,1 4,0 z" />
                <path d="m 10,1047.3622 3,0 0,1 1,0 0,1 -4,0 z" class="fill" />
              </g>
            </svg>
            {{/transit}}
          </li>
          {{/variants}}
        </ul> 
        {{/variants}}
        <div class="preview" decorator="previewMap:{{this}}"></div>
      </div>
    {{/layers}}

    <p class="clear"><strong>Overlays</strong></p>
    {{#overlays}}
      <div on-click="toggleOverlay:{{this}}" class="layer-preview {{ activeOverlays.hasOwnProperty(name) ? 'active' : '' }}">
        <span class="title">{{name}}</span>
        <div class="preview" decorator="previewMap:{{this}}"></div>
      </div>
    {{/overlays}}
  </div>
  {{/expanded}}
</div>
